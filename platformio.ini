;========================================================================================
; PlatformIO – konfiguracja projektu ESP32-C3
;========================================================================================

[platformio]
; Domyślne środowisko kompilacji
default_envs = release

[env]
; Platforma i framework
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino

; Monitor portu szeregowego
monitor_speed = 115200          ; prędkość komunikacji przez USB
upload_speed = 921600           ; prędkość wgrywania firmware

; Protokoły uploadu
upload_protocol = esptool       ; standardowy uploader dla ESP32

; Parametry sprzętowe
board_build.partitions = default.csv  ; tabela partycji
board_build.f_cpu = 160000000L        ; taktowanie CPU 160 MHz
board_build.f_flash = 80000000L       ; taktowanie flash 80 MHz
board_build.flash_mode = dio           ; tryb komunikacji z flash
board_build.flash_size = 4MB           ; rozmiar pamięci flash
board_build.arduino.usb_mode = 1       ; włącz USB CDC

; Biblioteki
lib_deps = 
    adafruit/Adafruit SSD1306@^2.5.9
    adafruit/Adafruit GFX Library@^1.11.9
    adafruit/Adafruit BusIO@^1.15.0
    links2004/WebSockets@^2.4.1
    bblanchon/ArduinoJson@^6.21.4

; Filtry wyjścia monitora szeregowego
monitor_filters = 
    default
    time

;========================================================================================
; Środowisko RELEASE – optymalizacja pod produkcję
;========================================================================================
[env:release]
build_flags = 
    -Os                              ; optymalizacja kodu pod rozmiar
    -Wno-deprecated-declarations     ; ignoruj ostrzeżenia o przestarzałych funkcjach
    -DCORE_DEBUG_LEVEL=0             ; poziom logów rdzenia 0 (bez debug)
    -DDEBUG_UART=0                   ; wyłączenie debug UART
    -ffunction-sections              ; umieszczanie funkcji w sekcjach
    -fdata-sections                  ; umieszczanie danych w sekcjach
    -Wl,--gc-sections                ; usuwanie nieużywanych sekcji
    -DBOARD_HAS_PSRAM=0              ; brak PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1      ; aktywacja USB CDC przy starcie
    -DARDUINO_USB_MODE=1             ; włącz tryb USB
    -I.                              ; dodaj bieżący katalog do ścieżki include

;========================================================================================
; Środowisko DEBUG – debugowanie i testy
;========================================================================================
[env:debug]
build_flags = 
    -O0                              ; brak optymalizacji (łatwiej debugować)
    -g                               ; dodaj informacje debugowe
    -Wno-deprecated-declarations
    -DCORE_DEBUG_LEVEL=5             ; maksymalny poziom logów
    -DDEBUG_UART=1                   ; włącz debug UART
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -I.

monitor_filters = 
    default
    time
    esp32_exception_decoder          ; dekodowanie crashy ESP32
